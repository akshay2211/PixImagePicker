# Workflow for Android CI debug build and code quality checks

name: Android CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  code-quality:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'gradle'

      - name: Make gradlew executable
        run: chmod +x ./gradlew

      - name: Run Spotless Check
        run: ./gradlew :pix:spotlessCheck

      - name: Run Detekt
        run: ./gradlew :pix:detekt

      - name: Upload Detekt Report
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: detekt-report
          path: pix/build/reports/detekt/

  build:
    needs: code-quality
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: 'gradle'

    - name: Make gradlew executable
      run: chmod +x ./gradlew

    - name: Build with Gradle
      run: ./gradlew :pix:build

    - name: Generate Documentation
      run: ./gradlew :pix:dokkaGenerate

    - name: Upload Documentation
      uses: actions/upload-artifact@v4
      with:
        name: api-documentation
        path: pix/build/dokka/html/